import { useState } from 'react';
import * as XLSX from 'xlsx';

const getPakanPerEkor = (umur: number): number => {
  if (umur <= 4) return 30;
  if (umur <= 8) return 40;
  if (umur <= 12) return 60;
  if (umur <= 16) return 70;
  return 75;
};

const FarmKalkulatorPakan: React.FC = () => {
  // 1️⃣ STATE
  const [jumlahAyam, setJumlahAyam] = useState(15);
  const [umur, setUmur] = useState(12);
  const [hargaPakan, setHargaPakan] = useState(8000);

  // 2️⃣ HITUNGAN
  const pakanPerEkor = getPakanPerEkor(umur);
  const totalPakanGram = jumlahAyam * pakanPerEkor;
  const totalPakanKg = totalPakanGram / 1000;
  const biayaHarian = totalPakanKg * hargaPakan;
  const biayaBulanan = biayaHarian * 30;


  // 2️⃣ Simpan ke Excel
  const worksheet = XLSX.utils.json_to_sheet(data);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Kalkulator Pakan');
  XLSX.writeFile(
    workbook,
    `kalkulator-pakan-${new Date().toISOString().slice(0, 10)}.xlsx`
  );

  // 3️⃣ Simpan ke localStorage
  const logs = JSON.parse(localStorage.getItem('farmLogs') || '[]');
  logs.push({
    tanggal: new Date().toLocaleDateString('id-ID'),
    jumlahAyam,
    umur,
    pakanPerEkor,
    totalPakanKg: Number(totalPakanKg.toFixed(2)),
    biayaHarian: Math.round(biayaHarian),
    biayaBulanan: Math.round(biayaBulanan),
  });
  localStorage.setItem('farmLogs', JSON.stringify(logs));
};